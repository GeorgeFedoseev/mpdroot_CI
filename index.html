<html>
  <head>
    <script src="lib/js/jquery-1.12.3.min.js"></script>
    <script src="lib/js/papaparse.min.js" ></script>
    <script src="lib/js/d3.min.js" ></script>
    <script src="lib/js/metricsgraphics.js" ></script>

    <link rel="stylesheet" href="lib/css/metricsgraphics.css" ></link>
    <link rel="stylesheet" href="lib/css/metricsgraphics-demo.css" ></link>
    <link rel="stylesheet" href="lib/css/bootstrap.min.css" ></link>
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet" type="text/css">
    <style>
      html{
        font-size: 15px;
      }

      .gr_container{
        margin-top: 50px;
        margin-left: 0px;
      }
    </style>
  </head>
  <body>
    <div class="gr_container">

    </div>
  </body>



  <script>

    $(document).ready(function(){
      drawColumn("data/no_tasks.csv", 48, "test0", "Нет задач", "Загрузка CPU")
      drawColumn("data/2_simult_j8.csv", 48, "test1", "2 задачи параллельно -j8 (по каждому ядру)", "Загрузка ядра(1-8) CPU", true, 1, true)
      drawColumn("data/2_simult_j4.csv", 48, "test2", "2 задачи параллельно -j4", "Загрузка CPU")
      drawColumn("data/one_commit_j1.csv", 48, "test3", "Один коммит (1 ядро)", "Загрузка CPU")
      drawColumn("data/one_commit_j2.csv", 48, "test4", "Один коммит (2 ядра)", "Загрузка CPU")
      drawColumn("data/one_commit_j8.csv", 48, "test5", "Один коммит (8 ядер)", "Загрузка CPU")
      drawColumn("data/one_commit_j4.csv", 48, "test6", "Один коммит (4 ядра)", "Загрузка CPU")
      //drawColumn("data/one_commit.csv", 54, "test3", "Использование памяти", "память (ГБ)", false, 0.000000001)
    });





    function drawColumn(filename, column, id, title, y_title, percentage, y_mltpl, diff_cores){
      $(".gr_container").append($("<div>").attr("id", id));

      if(diff_cores == undefined)
        diff_cores = false

      if(percentage == undefined)
        percentage = true;

      if(y_mltpl == undefined)
        y_mltpl = 1;

      $.get(filename, function(data){
        Papa.parse(data, {
          dynamicTyping: true,
          complete: function(res){
            //  console.log(res)
              _drawColumn(res, column, id, title, y_title, percentage, y_mltpl, diff_cores)
          }
        });
      });

      function _drawColumn(raw_data, column, id, title, y_title, percentage, y_mltpl, diff_cores){
        var data = [];
        if(!diff_cores){
          var i = 0;
          for(var k in raw_data.data){
            if(parseInt(k) > 6){
              var val = raw_data.data[k][column];
              if(val != undefined){
                data[i] = {
                  time: i,
                  value: val*y_mltpl
                }

                i++;
              }
            }
          }
        }else{
          var core = 0;
          while(core < 8){
            var core_data = [];

            var i = 0;
            for(var k in raw_data.data){
              if(parseInt(k) > 6){
                var val = raw_data.data[k][core*6];
                if(val != undefined){
                  core_data[i] = {
                    time: i,
                    value: val*y_mltpl
                  }

                  i++;
                }
              }
            }

            data.push(core_data);
            core++;
          }
            console.log(data)
        }




        var markers = [
          /*{
           'time': 50,
           'label': '1st Milestone'
         }*/
        ];



        MG.data_graphic({
          title: title,
          //description: "Here is an example that shows percentages.",
          data: data,
          markers: markers,
          width: 700,
          height: 200,
          left: 120,
          area: true,
          y_extended_ticks: true,
          x_accessor: 'time',
          y_accessor: 'value',
          x_label: "время (секунды)",
          y_label: y_title,
          yax_format: percentage==true?function(v){return v+"%"}:null,
          target: '#'+id,
          max_x: 300,
          max_y: 100,
          y_rug: true
        });

        }
      }



  </script>
</html>
